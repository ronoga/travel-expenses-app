<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ±</title>
    
	<!-- Favicon -->
    <link rel="icon" href="travel.ico" type="image/x-icon">
    <!-- Tailwind CSS v3.x -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- IRANSans Font -->
    <style>
        @font-face {
            font-family: 'IRANSans';
            src: url('IRANSans-web.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'IRANSans', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .hidden {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Floating button for mobile */
        .floating-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 115, 223, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(78, 115, 223, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 115, 223, 0); }
        }
        
        /* Profile completion modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 1.5rem;
            max-width: 500px;
            width: 100%;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .text-4xl { font-size: 1.875rem; }
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
            .text-xl { font-size: 1.125rem; }
            .px-6 { padding-left: 1rem; padding-right: 1rem; }
            .py-6 { padding-top: 1rem; padding-bottom: 1rem; }
            .gap-6 { gap: 1rem; }
            .mb-8 { margin-bottom: 1rem; }
            .rounded-xl { border-radius: 0.75rem; }
            .modal-content { padding: 1.5rem; }
        }
    </style>
    
    <!-- Supabase JS -->
     <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen scroll-smooth">
    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2 space-x-reverse">
                    <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-xl font-bold text-gray-800">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ±</span>
                </div>
                <div id="userInfo" class="hidden">
                    <span id="userName" class="text-gray-700 font-semibold"></span>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm mr-3">
                        Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Section - Always shown first -->
    <section id="login-section" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-2xl shadow-xl p-6 max-w-md mx-auto animate-fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center flex items-center justify-center">
                <svg class="h-7 w-7 text-blue-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                </svg>
                ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ú©Ø¯ Ù…Ù„ÛŒ</label>
                    <input type="text" id="nationalCode" placeholder="Ù…Ø«Ø§Ù„: 0012345678" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"
                           maxlength="10" oninput="validateNationalCode(this)">
                    <p id="nationalCodeError" class="text-red-500 text-xs mt-1 hidden">Ú©Ø¯ Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ 10 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
                    <input type="tel" id="phoneNumber" placeholder="Ù…Ø«Ø§Ù„: 09123456789" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"
                           maxlength="11" oninput="validatePhoneNumber(this)">
                    <p id="phoneNumberError" class="text-red-500 text-xs mt-1 hidden">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯ Ùˆ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯</p>
                </div>
                
                <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold text-base">
                    <svg class="inline-block h-5 w-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                </button>
                
                <p class="text-sm text-gray-600 text-center mt-4">
                    <strong>ğŸ’¡ ØªÙˆØ¶ÛŒØ­:</strong> Ø¨Ø§ ÙˆØ±ÙˆØ¯ØŒ Ø´Ù…Ø§ Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©ÛŒ Ù‡Ù…Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø§Ù…Ø§ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ ÙÙ‚Ø· Ø®ÙˆØ¯ØªØ§Ù† Ø±Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒØ¯.
                </p>
            </div>
        </div>
    </section>

    <!-- Profile Completion Modal (Shown after first login) -->
    <div id="profileModal" class="hidden modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§ ğŸ‘¤</h2>
            <p class="text-gray-600 mb-6 text-center">Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                    <input type="text" id="profileFullName" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                </div>
                
                <button onclick="completeProfile()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold text-base">
                    <svg class="inline-block h-5 w-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    ØªÚ©Ù…ÛŒÙ„ Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden until login and profile completion) -->
    <main id="main-content" class="hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Members Section - Ø¨Ø¯ÙˆÙ† Ø¨Ø®Ø´ Ø§ÙØ²ÙˆØ¯Ù† ÙØ±Ø¯ Ø¬Ø¯ÛŒØ¯ -->
        <section id="members" class="mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="h-7 w-7 text-blue-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    Ø§ÙØ±Ø§Ø¯ Ú¯Ø±ÙˆÙ‡
                </h2>
                
                <div class="bg-green-50 rounded-xl p-5">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§</h3>
                    <div id="members-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Members will be added here dynamically -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Shared Expenses Section -->
        <section id="shared-expenses" class="mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="h-7 w-7 text-green-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©ÛŒ (Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡)
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-green-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø´ØªØ±Ø§Ú©ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ±Ø¯</label>
                                <select id="shared-expense-member" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-base">
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ù‡Ø²ÛŒÙ†Ù‡ (ØªÙˆÙ…Ø§Ù†)</label>
                                <input type="number" id="shared-expense-amount" placeholder="Ù…Ø«Ø§Ù„: 150000" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-base" min="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <input type="text" id="shared-expense-description" placeholder="Ù…Ø«Ø§Ù„: Ù‡ØªÙ„ØŒ ØºØ°Ø§ØŒ Ø¨Ù†Ø²ÛŒÙ†" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-base">
                            </div>
                            <button onclick="addSharedExpense()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold text-base">
                                <svg class="inline-block h-5 w-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø´ØªØ±Ø§Ú©ÛŒ
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©ÛŒ</h3>
                        <div id="shared-expenses-list" class="space-y-3 max-h-80 overflow-y-auto">
                            <!-- Shared expenses will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Personal Expenses Section -->
        <section id="personal-expenses" class="mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="h-7 w-7 text-orange-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ (ÙÙ‚Ø· Ø®ÙˆØ¯ØªØ§Ù†)
                </h2>
                <p class="text-sm text-gray-600 mb-4 bg-orange-50 p-3 rounded-lg">
                    <strong>ğŸ”’ Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ:</strong> Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª Ùˆ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯.
                </p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-orange-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø´Ø®ØµÛŒ Ø¬Ø¯ÛŒØ¯</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ù‡Ø²ÛŒÙ†Ù‡ (ØªÙˆÙ…Ø§Ù†)</label>
                                <input type="number" id="personal-expense-amount" placeholder="Ù…Ø«Ø§Ù„: 50000" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-base" min="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                                <input type="text" id="personal-expense-description" placeholder="Ù…Ø«Ø§Ù„: Ù‡Ø¯ÛŒÙ‡ØŒ Ø®Ø±ÛŒØ¯ Ø´Ø®ØµÛŒ" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-base">
                            </div>
                            <button onclick="addPersonalExpense()" class="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition font-semibold text-base">
                                <svg class="inline-block h-5 w-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø´Ø®ØµÛŒ
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ</h3>
                        <div id="personal-expenses-list" class="space-y-3 max-h-80 overflow-y-auto">
                            <!-- Personal expenses will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary Section -->
        <section id="summary" class="mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="h-7 w-7 text-purple-600 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Ø®Ù„Ø§ØµÙ‡ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ø§Øª
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-100 rounded-xl p-5 text-center border-2 border-blue-200">
                        <h3 class="text-sm font-semibold text-gray-800 mb-1">Ù…Ø¬Ù…ÙˆØ¹ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©ÛŒ</h3>
                        <p id="total-shared-expenses" class="text-2xl font-bold text-blue-600">0 ØªÙˆÙ…Ø§Ù†</p>
                    </div>
                    <div class="bg-orange-100 rounded-xl p-5 text-center border-2 border-orange-200">
                        <h3 class="text-sm font-semibold text-gray-800 mb-1">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ Ø´Ù…Ø§</h3>
                        <p id="total-personal-expenses" class="text-2xl font-bold text-orange-600">0 ØªÙˆÙ…Ø§Ù†</p>
                    </div>
                    <div class="bg-purple-100 rounded-xl p-5 text-center border-2 border-purple-200">
                        <h3 class="text-sm font-semibold text-gray-800 mb-1">Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„ Ø³ÙØ±</h3>
                        <p id="total-travel-expenses" class="text-2xl font-bold text-purple-600">0 ØªÙˆÙ…Ø§Ù†</p>
                    </div>
                    <div class="bg-green-100 rounded-xl p-5 text-center border-2 border-green-200">
                        <h3 class="text-sm font-semibold text-gray-800 mb-1">ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ±Ø§Ø¯</h3>
                        <p id="total-members" class="text-2xl font-bold text-green-600">0 Ù†ÙØ±</p>
                    </div>
                </div>
                
                <div class="bg-yellow-50 rounded-xl p-5">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ø± ÙØ±Ø¯</h3>
                    <div id="member-details" class="space-y-3">
                        <!-- Member details will be added here dynamically -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Action Button for Mobile -->
    <button onclick="scrollToSection('summary')" class="floating-btn bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-4 rounded-full text-lg font-bold shadow-xl hidden" id="floatingBtn">
        ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ù„Ø§ØµÙ‡
    </button>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-400 text-sm">Â© 2026 Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ±. ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
            <p class="text-gray-400 text-sm mt-2">Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Tailwind CSS Ùˆ Supabase</p>
        </div>
    </footer>

    <script>
        // ========== Supabase Configuration ==========
        const SUPABASE_URL = 'https://mrjcfehwyzvaojvrkpmd.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_xrBrdAGjo1R-cRtCX07acw_wdVidDMl';
        
        // Initialize Supabase Client
        let supabaseClient = null;
        let currentUser = null;
        let currentUserId = null;
        let isProfileComplete = false;

        function initSupabase() {
            try {
                if (typeof supabase === 'undefined') {
                    console.warn('Supabase library not loaded');
                    return false;
                }
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('âœ… Supabase client initialized successfully');
                return true;
            } catch (error) {
                console.error('âŒ Error initializing Supabase:', error);
                return false;
            }
        }

        // ========== Data Storage ==========
        let members = [];
        let sharedExpenses = [];
        let personalExpenses = [];

        // ========== Initialize the app ==========
        async function initApp() {
            console.log('ğŸš€ Initializing app...');
            
            if (!initSupabase()) {
                alert('âŒ Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            // Ù‡Ù…ÛŒØ´Ù‡ Ø§ÙˆÙ„ ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('floatingBtn').classList.add('hidden');
            
            console.log('âœ… App initialized successfully!');
        }

        // ========== Validation Functions ==========
        function validateNationalCode(input) {
            const value = input.value;
            const errorElement = input.id === 'nationalCode' ? 
                document.getElementById('nationalCodeError') : 
                document.getElementById('memberNationalCodeError');
            
            if (value.length > 0 && value.length !== 10) {
                errorElement.classList.remove('hidden');
                return false;
            } else {
                errorElement.classList.add('hidden');
                return true;
            }
        }

        function validatePhoneNumber(input) {
            const value = input.value;
            const errorElement = document.getElementById('phoneNumberError');
            
            if (value.length > 0 && (value.length !== 11 || !value.startsWith('09'))) {
                errorElement.classList.remove('hidden');
                return false;
            } else {
                errorElement.classList.add('hidden');
                return true;
            }
        }

        // ========== Check if user profile is complete ==========
        async function checkProfileCompletion() {
            try {
                const { data: memberData, error: memberError } = await supabaseClient
                    .from('members')
                    .select('*')
                    .eq('national_code', currentUser.national_code)
                    .single();

                if (memberError && memberError.code === 'PGRST116') {
                    // Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¬Ø¯ÙˆÙ„ members ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ - Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¯Ø§Ø±Ø¯
                    isProfileComplete = false;
                    showProfileModal();
                } else if (memberError) {
                    throw memberError;
                } else {
                    // Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¬Ø¯ÙˆÙ„ members ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                    isProfileComplete = true;
                    currentUser.member = memberData;
                    loadMainContent();
                }
                
            } catch (error) {
                console.error('Error checking profile completion:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ' + error.message);
            }
        }

        // ========== Show Profile Completion Modal ==========
        function showProfileModal() {
            document.getElementById('profileModal').classList.remove('hidden');
        }

        // ========== Complete Profile ==========
        async function completeProfile() {
            const fullName = document.getElementById('profileFullName').value.trim();
            
            if (!fullName) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            try {
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ members
                const { data: memberData, error: memberError } = await supabaseClient
                    .from('members')
                    .insert([{ 
                        name: fullName,
                        national_code: currentUser.national_code
                    }])
                    .select()
                    .single();

                if (memberError) {
                    throw memberError;
                }

                // Ø¢Ù¾Ø¯ÛŒØª Ú©Ø±Ø¯Ù† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¬Ø¯ÙˆÙ„ users
                await supabaseClient
                    .from('users')
                    .update({ name: fullName })
                    .eq('id', currentUserId);

                currentUser.name = fullName;
                currentUser.member = memberData;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                isProfileComplete = true;
                document.getElementById('profileModal').classList.add('hidden');
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ
                loadMainContent();
                
                alert('âœ… Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.');
                
            } catch (error) {
                console.error('Error completing profile:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„: ' + error.message);
            }
        }

        // ========== Load Main Content ==========
        async function loadMainContent() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('floatingBtn').classList.remove('hidden');
            document.getElementById('login-section').classList.add('hidden');
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            await loadMembers();
            await loadSharedExpenses();
            await loadPersonalExpenses();
            updateSummary();
        }

        // ========== Login Function ==========
        async function login() {
            const nationalCode = document.getElementById('nationalCode').value.trim();
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            
            if (!validateNationalCode({value: nationalCode, id: 'nationalCode'})) {
                alert('âš ï¸ Ú©Ø¯ Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ 10 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯');
                return;
            }
            
            if (!validatePhoneNumber({value: phoneNumber, id: 'phoneNumber'})) {
                alert('âš ï¸ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯ Ùˆ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯');
                return;
            }

            try {
                const { data: existingUser, error: fetchError } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('national_code', nationalCode)
                    .eq('phone_number', phoneNumber)
                    .single();

                if (fetchError && fetchError.code !== 'PGRST116') {
                    throw fetchError;
                }

                if (existingUser) {
                    // Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
                    currentUser = existingUser;
                    currentUserId = currentUser.id;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Ú†Ú© Ú©Ø±Ø¯Ù† ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                    await checkProfileCompletion();
                    
                } else {
                    // Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ - Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                    const { data: newUser, error: insertError } = await supabaseClient
                        .from('users')
                        .insert([{ 
                            national_code: nationalCode, 
                            phone_number: phoneNumber,
                            name: 'Ú©Ø§Ø±Ø¨Ø± ' + nationalCode.substring(0, 4)
                        }])
                        .select()
                        .single();

                    if (insertError) {
                        throw insertError;
                    }

                    currentUser = newUser;
                    currentUserId = currentUser.id;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Ú†Ú© Ú©Ø±Ø¯Ù† ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ (Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø­ØªÙ…Ø§Ù‹ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø¯Ø§Ø±Ø¯)
                    await checkProfileCompletion();
                }
                
            } catch(error) {
                console.error('Error in login:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: ' + error.message);
            }
        }

        // ========== Logout Function ==========
        function logout() {
            currentUser = null;
            currentUserId = null;
            isProfileComplete = false;
            localStorage.removeItem('currentUser');
            
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('floatingBtn').classList.add('hidden');
            document.getElementById('profileModal').classList.add('hidden');
            
            // Clear forms
            document.getElementById('nationalCode').value = '';
            document.getElementById('phoneNumber').value = '';
            document.getElementById('profileFullName').value = '';
            
            alert('âœ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯.');
        }

        // ========== Scroll Functions ==========
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // ========== Load Members from Supabase ==========
        async function loadMembers() {
            try {
                const { data, error } = await supabaseClient
                    .from('members')
                    .select('*')
                    .order('created_at', { ascending: true });

                if(error) {
                    throw error;
                }

                members = data || [];
                updateMembersList();
                updateExpenseForms();
                console.log('ğŸ‘¥ Loaded members:', members);
                
            } catch(error) {
                console.error('Error loading members:', error);
                members = [];
            }
        }

        // ========== Update Members List UI ==========
        function updateMembersList() {
            const membersList = document.getElementById('members-list');
            membersList.innerHTML = '';

            if(members.length === 0) {
                membersList.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm">Ù‡ÛŒÚ† ÙØ±Ø¯ÛŒ Ø¯Ø± Ú¯Ø±ÙˆÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            members.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'bg-white p-3 rounded-lg shadow flex justify-between items-center border-l-3 border-blue-500';
                memberDiv.innerHTML = `
                    <div>
                        <span class="font-semibold text-gray-800 text-sm">${member.name}</span>
                    </div>
                `;
                membersList.appendChild(memberDiv);
            });
        }

        // ========== Add Shared Expense ==========
        async function addSharedExpense() {
            const memberSelect = document.getElementById('shared-expense-member');
            const amountInput = document.getElementById('shared-expense-amount');
            const descriptionInput = document.getElementById('shared-expense-description');

            const memberId = parseInt(memberSelect.value);
            const amount = parseInt(amountInput.value);
            const description = descriptionInput.value.trim();

            if(!memberId || !amount) {
                alert('âš ï¸ Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('expenses')
                    .insert([{ 
                        member_id: memberId, 
                        amount: amount,
                        description: description,
                        is_shared: true,
                        user_id: currentUserId
                    }])
                    .select();

                if(error) {
                    throw error;
                }

                memberSelect.value = '';
                amountInput.value = '';
                descriptionInput.value = '';
                
                await loadSharedExpenses();
                updateSharedExpensesList();
                updateSummary();
                
                alert('âœ… Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø´ØªØ±Ø§Ú©ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
                
            } catch(error) {
                console.error('Error adding shared expense:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡: ' + error.message);
            }
        }

        // ========== Load Shared Expenses from Supabase ==========
        async function loadSharedExpenses() {
            try {
                const { data, error } = await supabaseClient
                    .from('expenses')
                    .select('*')
                    .eq('is_shared', true)
                    .order('created_at', { ascending: false });

                if(error) {
                    throw error;
                }

                sharedExpenses = data || [];
                updateSharedExpensesList();
                console.log('ğŸ’° Loaded shared expenses:', sharedExpenses);
                
            } catch(error) {
                console.error('Error loading shared expenses:', error);
                sharedExpenses = [];
            }
        }

        // ========== Update Shared Expenses List UI ==========
        function updateSharedExpensesList() {
            const expensesList = document.getElementById('shared-expenses-list');
            expensesList.innerHTML = '';

            if(sharedExpenses.length === 0) {
                expensesList.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm">Ù‡ÛŒÚ† Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
                return;
            }

            sharedExpenses.forEach(expense => {
                const member = members.find(m => m.id === expense.member_id);
                const expenseDiv = document.createElement('div');
                expenseDiv.className = 'bg-white p-3 rounded-lg shadow border-l-3 border-green-500';
                expenseDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-semibold text-gray-800 text-sm">${member ? member.name : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</span>
                            <p class="text-gray-600 mt-1 text-xs">${expense.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª'}</p>
                        </div>
                        <div class="text-left">
                            <span class="font-bold text-green-600 text-sm">${expense.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                            <p class="text-xs text-gray-500 mt-1">${new Date(expense.created_at).toLocaleDateString('fa-IR')}</p>
                        </div>
                    </div>
                `;
                expensesList.appendChild(expenseDiv);
            });
        }

        // ========== Add Personal Expense ==========
        async function addPersonalExpense() {
            const amountInput = document.getElementById('personal-expense-amount');
            const descriptionInput = document.getElementById('personal-expense-description');

            const amount = parseInt(amountInput.value);
            const description = descriptionInput.value.trim();

            if(!amount) {
                alert('âš ï¸ Ù„Ø·ÙØ§ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            try {
                const currentUserMember = currentUser.member;
                
                if (!currentUserMember) {
                    alert('âš ï¸ Ø´Ù…Ø§ Ø¯Ø± Ù„ÛŒØ³Øª Ø§ÙØ±Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯.');
                    return;
                }

                const { data, error } = await supabaseClient
                    .from('expenses')
                    .insert([{ 
                        member_id: currentUserMember.id,
                        amount: amount,
                        description: description,
                        is_shared: false,
                        user_id: currentUserId
                    }])
                    .select();

                if(error) {
                    throw error;
                }

                amountInput.value = '';
                descriptionInput.value = '';
                
                await loadPersonalExpenses();
                updatePersonalExpensesList();
                updateSummary();
                
                alert('âœ… Ù‡Ø²ÛŒÙ†Ù‡ Ø´Ø®ØµÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!');
                
            } catch(error) {
                console.error('Error adding personal expense:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡: ' + error.message);
            }
        }

        // ========== Load Personal Expenses from Supabase ==========
        async function loadPersonalExpenses() {
            try {
                const { data, error } = await supabaseClient
                    .from('expenses')
                    .select('*')
                    .eq('is_shared', false)
                    .eq('user_id', currentUserId)
                    .order('created_at', { ascending: false });

                if(error) {
                    throw error;
                }

                personalExpenses = data || [];
                updatePersonalExpensesList();
                console.log('ğŸ’° Loaded personal expenses:', personalExpenses);
                
            } catch(error) {
                console.error('Error loading personal expenses:', error);
                personalExpenses = [];
            }
        }

        // ========== Update Personal Expenses List UI ==========
        function updatePersonalExpensesList() {
            const expensesList = document.getElementById('personal-expenses-list');
            expensesList.innerHTML = '';

            if(personalExpenses.length === 0) {
                expensesList.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm">Ù‡ÛŒÚ† Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
                return;
            }

            personalExpenses.forEach(expense => {
                const expenseDiv = document.createElement('div');
                expenseDiv.className = 'bg-white p-3 rounded-lg shadow border-l-3 border-orange-500';
                expenseDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-semibold text-gray-800 text-sm">Ù‡Ø²ÛŒÙ†Ù‡ Ø´Ø®ØµÛŒ</span>
                            <p class="text-gray-600 mt-1 text-xs">${expense.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª'}</p>
                        </div>
                        <div class="text-left">
                            <span class="font-bold text-orange-600 text-sm">${expense.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                            <p class="text-xs text-gray-500 mt-1">${new Date(expense.created_at).toLocaleDateString('fa-IR')}</p>
                        </div>
                    </div>
                `;
                expensesList.appendChild(expenseDiv);
            });
        }

        // ========== Update Expense Forms ==========
        function updateExpenseForms() {
            const sharedMemberSelect = document.getElementById('shared-expense-member');
            
            sharedMemberSelect.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>';

            members.forEach(member => {
                const sharedOption = document.createElement('option');
                sharedOption.value = member.id;
                sharedOption.textContent = member.name;
                sharedMemberSelect.appendChild(sharedOption);
            });
        }

        // ========== Update Summary ==========
        function updateSummary() {
            const totalShared = sharedExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalPersonal = personalExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalTravel = totalShared + totalPersonal;
            const totalMembersCount = members.length;

            document.getElementById('total-shared-expenses').textContent = totalShared.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
            document.getElementById('total-personal-expenses').textContent = totalPersonal.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
            document.getElementById('total-travel-expenses').textContent = totalTravel.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
            document.getElementById('total-members').textContent = totalMembersCount + ' Ù†ÙØ±';

            // Update member details
            const memberDetails = document.getElementById('member-details');
            memberDetails.innerHTML = '';

            if(members.length === 0) {
                memberDetails.innerHTML = '<p class="text-gray-500 text-center py-4 text-sm">Ù‡ÛŒÚ† ÙØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }

            members.forEach(member => {
                const memberSharedExpenses = sharedExpenses.filter(e => e.member_id === member.id);
                const totalSharedSpent = memberSharedExpenses.reduce((sum, e) => sum + e.amount, 0);
                const sharedCount = memberSharedExpenses.length;

                const isCurrentUser = member.national_code === currentUser.national_code;
                let totalPersonalSpent = 0;
                let personalCount = 0;
                
                if (isCurrentUser) {
                    const memberPersonalExpenses = personalExpenses.filter(e => e.member_id === member.id);
                    totalPersonalSpent = memberPersonalExpenses.reduce((sum, e) => sum + e.amount, 0);
                    personalCount = memberPersonalExpenses.length;
                }

                const totalSpent = totalSharedSpent + totalPersonalSpent;

                const detailDiv = document.createElement('div');
                detailDiv.className = 'bg-white p-4 rounded-lg shadow border-l-3 ' + 
                    (isCurrentUser ? 'border-blue-500' : 'border-gray-300');
                detailDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold text-gray-800 text-lg">${member.name}</span>
                        <span class="font-bold ${isCurrentUser ? 'text-blue-600' : 'text-gray-600'}">${totalSpent.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-600 mb-2">
                        <div>
                            <span class="text-xs">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú©ÛŒ:</span>
                            <span class="font-semibold text-green-600 block">${totalSharedSpent.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                            <span class="text-xs">(${sharedCount} Ù‡Ø²ÛŒÙ†Ù‡)</span>
                        </div>
                        ${isCurrentUser ? `
                        <div>
                            <span class="text-xs">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ:</span>
                            <span class="font-semibold text-orange-600 block">${totalPersonalSpent.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                            <span class="text-xs">(${personalCount} Ù‡Ø²ÛŒÙ†Ù‡)</span>
                        </div>
                        ` : ''}
                    </div>
                    ${isCurrentUser ? '<p class="text-xs text-blue-500">Ø§ÛŒÙ† Ø´Ù…Ø§ Ù‡Ø³ØªÛŒØ¯ ğŸ‘¤</p>' : ''}
                `;
                memberDetails.appendChild(detailDiv);
            });
        }

        // ========== Initialize on page load ==========
        window.onload = initApp;

        // ========== Global functions ==========
        window.scrollToSection = scrollToSection;
        window.login = login;
        window.logout = logout;
        window.addSharedExpense = addSharedExpense;
        window.addPersonalExpense = addPersonalExpense;
        window.validateNationalCode = validateNationalCode;
        window.validatePhoneNumber = validatePhoneNumber;
        window.completeProfile = completeProfile;
    </script>
</body>
</html>